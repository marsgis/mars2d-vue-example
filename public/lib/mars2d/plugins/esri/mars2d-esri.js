/*!
 * Mars2D平台插件,ArcGIS Server功能支持插件
 * 版本信息：v3.0.7, hash值: c54cec7ba4195f660c8e
 * 编译日期：2022-02-20 16:50:56
 * 版权所有：Copyright by 火星科技 http://mars2d.cn
 * 
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("leaflet"),require("mars2d")):"function"==typeof define&&define.amd?define("mars2dEsri",["leaflet","mars2d"],e):"object"==typeof exports?exports.mars2dEsri=e(require("leaflet"),require("mars2d")):t.mars2dEsri=e(t.L,t.mars2d)}(window,(function(t,e){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=14)}([function(e,i){e.exports=t},function(t,i){t.exports=e},function(t,e){function i(e){return t.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},t.exports.__esModule=!0,t.exports.default=t.exports,i(e)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var r=i(10);function s(){return"undefined"!=typeof Reflect&&Reflect.get?(t.exports=s=Reflect.get,t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=s=function(t,e,i){var s=r(t,e);if(s){var n=Object.getOwnPropertyDescriptor(s,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}},t.exports.__esModule=!0,t.exports.default=t.exports),s.apply(this,arguments)}t.exports=s,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var r=i(11);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(t,"prototype",{value:Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),writable:!1}),e&&r(t,e)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var r=i(12).default,s=i(13);t.exports=function(t,e){if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return s(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t){t.exports=JSON.parse('{"name":"esri-leaflet","description":"Leaflet plugins for consuming ArcGIS Online and ArcGIS Server services.","version":"3.0.4","author":"Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)","bugs":{"url":"https://github.com/esri/esri-leaflet/issues"},"contributors":["Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)","John Gravois <jgravois@esri.com> (https://johngravois.com)","Gavin Rehkemper <grehkemper@esri.com> (https://gavinr.com)","Jacob Wasilkowski <jwasilkowski@esri.com> (https://jwasilgeo.github.io)"],"dependencies":{"@terraformer/arcgis":"^2.0.7","tiny-binary-search":"^1.0.3"},"devDependencies":{"@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^13.0.0","chai":"4.3.4","gh-release":"^6.0.0","highlight.js":"^10.7.2","http-server":"^0.12.3","husky":"^1.1.1","karma":"^6.3.2","karma-chai-sinon":"^0.1.5","karma-chrome-launcher":"^3.1.0","karma-coverage":"^2.0.3","karma-mocha":"^2.0.1","karma-mocha-reporter":"^2.2.5","karma-sourcemap-loader":"^0.3.8","leaflet":"^1.6.0","mkdirp":"^1.0.4","mocha":"^8.4.0","npm-run-all":"^4.1.5","rollup":"^2.49.0","rollup-plugin-uglify":"^6.0.4","semistandard":"^9.0.0","sinon":"^6.3.5","sinon-chai":"3.2.0","snazzy":"^8.0.0","uglify-js":"^2.8.29","watch":"^1.0.2"},"files":["src/**/*.js","dist/esri-leaflet.js","dist/esri-leaflet.js.map","dist/esri-leaflet-debug.js.map","profiles/*.js"],"homepage":"http://esri.github.io/esri-leaflet","module":"src/EsriLeaflet.js","jsnext:main":"src/EsriLeaflet.js","jspm":{"registry":"npm","format":"es6","main":"src/EsriLeaflet.js"},"keywords":["arcgis","esri","esri leaflet","gis","leaflet plugin","mapping"],"license":"Apache-2.0","main":"dist/esri-leaflet-debug.js","peerDependencies":{"leaflet":"^1.0.0"},"readmeFilename":"README.md","repository":{"type":"git","url":"git@github.com:Esri/esri-leaflet.git"},"scripts":{"build":"rollup -c profiles/debug.js & rollup -c profiles/production.js","lint":"semistandard | snazzy","prebuild":"mkdirp dist","prepare":"npm run build","pretest":"npm run build","precommit":"npm run lint","fix":"semistandard --fix","release":"./scripts/release.sh","start-watch":"watch \\"npm run build\\" src","start":"run-p start-watch serve","serve":"http-server -p 5000 -c-1 -o","test":"npm run lint && karma start","test:ci":"npm run lint && karma start --browsers Chrome_travis_ci"},"semistandard":{"globals":["expect","L","XMLHttpRequest","sinon","xhr","proj4"]},"unpkg":"dist/esri-leaflet-debug.js","__npminstall_done":"Wed Dec 22 2021 11:56:15 GMT+0800 (中国标准时间)","_from":"esri-leaflet@3.0.4","_resolved":"https://registry.npmmirror.com/esri-leaflet/download/esri-leaflet-3.0.4.tgz"}')},function(t,e){t.exports=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var r=i(2);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function i(e,r){return t.exports=i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},t.exports.__esModule=!0,t.exports.default=t.exports,i(e,r)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function i(e){return t.exports=i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,i(e)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){"use strict";i.r(e),i.d(e,"ArcGisImageLayer",(function(){return te})),i.d(e,"ArcGisTileLayer",(function(){return ie})),i.d(e,"ArcGisDynamicLayer",(function(){return se})),i.d(e,"ArcGisFeatureLayer",(function(){return ce}));var r={};i.r(r),i.d(r,"VERSION",(function(){return Dt})),i.d(r,"Support",(function(){return l})),i.d(r,"options",(function(){return c})),i.d(r,"Util",(function(){return Q})),i.d(r,"get",(function(){return _})),i.d(r,"post",(function(){return d})),i.d(r,"request",(function(){return y})),i.d(r,"Task",(function(){return H})),i.d(r,"task",(function(){return K})),i.d(r,"Query",(function(){return X})),i.d(r,"query",(function(){return Y})),i.d(r,"Find",(function(){return tt})),i.d(r,"find",(function(){return et})),i.d(r,"Identify",(function(){return rt})),i.d(r,"identify",(function(){return st})),i.d(r,"IdentifyFeatures",(function(){return nt})),i.d(r,"identifyFeatures",(function(){return ot})),i.d(r,"IdentifyImage",(function(){return ut})),i.d(r,"identifyImage",(function(){return lt})),i.d(r,"Service",(function(){return pt})),i.d(r,"service",(function(){return ht})),i.d(r,"MapService",(function(){return ft})),i.d(r,"mapService",(function(){return dt})),i.d(r,"ImageService",(function(){return yt})),i.d(r,"imageService",(function(){return gt})),i.d(r,"FeatureLayerService",(function(){return vt})),i.d(r,"featureLayerService",(function(){return bt})),i.d(r,"BasemapLayer",(function(){return St})),i.d(r,"basemapLayer",(function(){return At})),i.d(r,"TiledMapLayer",(function(){return wt})),i.d(r,"tiledMapLayer",(function(){return It})),i.d(r,"RasterLayer",(function(){return Ot})),i.d(r,"ImageMapLayer",(function(){return Ct})),i.d(r,"imageMapLayer",(function(){return Pt})),i.d(r,"DynamicMapLayer",(function(){return Rt})),i.d(r,"dynamicMapLayer",(function(){return kt})),i.d(r,"FeatureManager",(function(){return jt})),i.d(r,"FeatureLayer",(function(){return Gt})),i.d(r,"featureLayer",(function(){return Et}));var s=i(0),n=i.n(s),o=i(8),a=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,u=""===document.documentElement.style.pointerEvents,l={cors:a,pointerEvents:u},c={attributionWidthOffset:55},p=0;function h(t){var e="";for(var i in t.f=t.f||"json",t)if(t.hasOwnProperty(i)){var r,s=t[i],n=Object.prototype.toString.call(s);e.length&&(e+="&"),r="[object Array]"===n?"[object Object]"===Object.prototype.toString.call(s[0])?JSON.stringify(s):s.join(","):"[object Object]"===n?JSON.stringify(s):"[object Date]"===n?s.valueOf():s,e+=encodeURIComponent(i)+"="+encodeURIComponent(r)}return e}function f(t,e){var i=new window.XMLHttpRequest;return i.onerror=function(r){i.onreadystatechange=s.Util.falseFn,t.call(e,{error:{code:500,message:"XMLHttpRequest error"}},null)},i.onreadystatechange=function(){var r,n;if(4===i.readyState){try{r=JSON.parse(i.responseText)}catch(t){r=null,n={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!n&&r.error&&(n=r.error,r=null),i.onerror=s.Util.falseFn,t.call(e,n,r)}},i.ontimeout=function(){this.onerror()},i}function d(t,e,i,r){var s=f(i,r);return s.open("POST",t),null!=r&&void 0!==r.options&&(s.timeout=r.options.timeout),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),s.send(h(e)),s}function m(t,e,i,r){var s=f(i,r);return s.open("GET",t+"?"+h(e),!0),null!=r&&void 0!==r.options&&(s.timeout=r.options.timeout,r.options.withCredentials&&(s.withCredentials=!0)),s.send(null),s}function y(t,e,i,r){var s=h(e),n=f(i,r),o=(t+"?"+s).length;if(o<=2e3&&l.cors?n.open("GET",t+"?"+s):o>2e3&&l.cors&&(n.open("POST",t),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),null!=r&&void 0!==r.options&&(n.timeout=r.options.timeout,r.options.withCredentials&&(n.withCredentials=!0)),o<=2e3&&l.cors)n.send(null);else{if(!(o>2e3&&l.cors))return o<=2e3&&!l.cors?g(t,e,i,r):void v("a request to "+t+" was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy http://esri.github.io/esri-leaflet/api-reference/request.html");n.send(s)}return n}function g(t,e,i,r){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var n="c"+p;e.callback="window._EsriLeafletCallbacks."+n,window._EsriLeafletCallbacks[n]=function(t){if(!0!==window._EsriLeafletCallbacks[n]){var e,s=Object.prototype.toString.call(t);"[object Object]"!==s&&"[object Array]"!==s&&(e={error:{code:500,message:"Expected array or object as JSONP response"}},t=null),!e&&t.error&&(e=t,t=null),i.call(r,e,t),window._EsriLeafletCallbacks[n]=!0}};var o=s.DomUtil.create("script",null,document.body);return o.type="text/javascript",o.src=t+"?"+h(e),o.id=n,o.onerror=function(t){if(t&&!0!==window._EsriLeafletCallbacks[n]){i.call(r,{error:{code:500,message:"An unknown error occurred"}}),window._EsriLeafletCallbacks[n]=!0}},s.DomUtil.addClass(o,"esri-leaflet-jsonp"),p++,{id:n,url:o.src,abort:function(){window._EsriLeafletCallbacks._callback[n]({code:0,message:"Request aborted."})}}}var _=l.cors?m:g;function v(){console&&console.warn&&console.warn.apply(console,arguments)}_.CORS=m,_.JSONP=g;var b={request:y,get:_,post:d},x=function(t,e,i,r){var s=(r[0]-i[0])*(t[1]-i[1])-(r[1]-i[1])*(t[0]-i[0]),n=(e[0]-t[0])*(t[1]-i[1])-(e[1]-t[1])*(t[0]-i[0]),o=(r[1]-i[1])*(e[0]-t[0])-(r[0]-i[0])*(e[1]-t[1]);if(0!==o){var a=s/o,u=n/o;if(a>=0&&a<=1&&u>=0&&u<=1)return!0}return!1},L=function(t,e){for(var i=0;i<t.length-1;i++)for(var r=0;r<e.length-1;r++)if(x(t[i],t[i+1],e[r],e[r+1]))return!0;return!1},S=function(t){return function(t,e){for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}(t[0],t[t.length-1])||t.push(t[0]),t},A=function(t){for(var e,i=0,r=0,s=t.length,n=t[r];r<s-1;r++)i+=((e=t[r+1])[0]-n[0])*(e[1]+n[1]),n=e;return i>=0},w=function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},I=function(t,e){var i=L(t,e),r=function(t,e){for(var i=!1,r=-1,s=t.length,n=s-1;++r<s;n=r)(t[r][1]<=e[1]&&e[1]<t[n][1]||t[n][1]<=e[1]&&e[1]<t[r][1])&&e[0]<(t[n][0]-t[r][0])*(e[1]-t[r][1])/(t[n][1]-t[r][1])+t[r][0]&&(i=!i);return i}(t,e[0]);return!(i||!r)},T=function t(e,i){var r={};if(e.features){r.type="FeatureCollection",r.features=[];for(var s=0;s<e.features.length;s++)r.features.push(t(e.features[s],i))}if("number"==typeof e.x&&"number"==typeof e.y&&(r.type="Point",r.coordinates=[e.x,e.y],"number"==typeof e.z&&r.coordinates.push(e.z)),e.points&&(r.type="MultiPoint",r.coordinates=e.points.slice(0)),e.paths&&(1===e.paths.length?(r.type="LineString",r.coordinates=e.paths[0].slice(0)):(r.type="MultiLineString",r.coordinates=e.paths.slice(0))),e.rings&&(r=function(t){for(var e,i,r,s=[],n=[],o=0;o<t.length;o++){var a=S(t[o].slice(0));if(!(a.length<4))if(A(a)){var u=[a.slice().reverse()];s.push(u)}else n.push(a.slice().reverse())}for(var l=[];n.length;){r=n.pop();var c=!1;for(e=s.length-1;e>=0;e--)if(i=s[e][0],I(i,r)){s[e].push(r),c=!0;break}c||l.push(r)}for(;l.length;){r=l.pop();var p=!1;for(e=s.length-1;e>=0;e--)if(i=s[e][0],L(i,r)){s[e].push(r),p=!0;break}p||s.push([r.reverse()])}return 1===s.length?{type:"Polygon",coordinates:s[0]}:{type:"MultiPolygon",coordinates:s}}(e.rings.slice(0))),"number"==typeof e.xmin&&"number"==typeof e.ymin&&"number"==typeof e.xmax&&"number"==typeof e.ymax&&(r.type="Polygon",r.coordinates=[[[e.xmax,e.ymax],[e.xmin,e.ymax],[e.xmin,e.ymin],[e.xmax,e.ymin],[e.xmax,e.ymax]]]),(e.geometry||e.attributes)&&(r.type="Feature",r.geometry=e.geometry?t(e.geometry):null,r.properties=e.attributes?w(e.attributes):null,e.attributes))try{r.id=function(t,e){for(var i=e?[e,"OBJECTID","FID"]:["OBJECTID","FID"],r=0;r<i.length;r++){var s=i[r];if(s in t&&("string"==typeof t[s]||"number"==typeof t[s]))return t[s]}throw Error("No valid id attribute found")}(e.attributes,i)}catch(t){}return JSON.stringify(r.geometry)===JSON.stringify({})&&(r.geometry=null),e.spatialReference&&e.spatialReference.wkid&&4326!==e.spatialReference.wkid&&console.warn("Object converted in non-standard crs - "+JSON.stringify(e.spatialReference)),r},O=function(t){var e=[],i=t.slice(0),r=S(i.shift().slice(0));if(r.length>=4){A(r)||r.reverse(),e.push(r);for(var s=0;s<i.length;s++){var n=S(i[s].slice(0));n.length>=4&&(A(n)&&n.reverse(),e.push(n))}}return e},C=function t(e,i){i=i||"OBJECTID";var r,s={wkid:4326},n={};switch(e.type){case"Point":n.x=e.coordinates[0],n.y=e.coordinates[1],e.coordinates[2]&&(n.z=e.coordinates[2]),n.spatialReference=s;break;case"MultiPoint":n.points=e.coordinates.slice(0),e.coordinates[0][2]&&(n.hasZ=!0),n.spatialReference=s;break;case"LineString":n.paths=[e.coordinates.slice(0)],e.coordinates[0][2]&&(n.hasZ=!0),n.spatialReference=s;break;case"MultiLineString":n.paths=e.coordinates.slice(0),e.coordinates[0][0][2]&&(n.hasZ=!0),n.spatialReference=s;break;case"Polygon":n.rings=O(e.coordinates.slice(0)),e.coordinates[0][0][2]&&(n.hasZ=!0),n.spatialReference=s;break;case"MultiPolygon":n.rings=function(t){for(var e=[],i=0;i<t.length;i++)for(var r=O(t[i]),s=r.length-1;s>=0;s--){var n=r[s].slice(0);e.push(n)}return e}(e.coordinates.slice(0)),e.coordinates[0][0][0][2]&&(n.hasZ=!0),n.spatialReference=s;break;case"Feature":e.geometry&&(n.geometry=t(e.geometry,i)),n.attributes=e.properties?w(e.properties):{},e.id&&(n.attributes[i]=e.id);break;case"FeatureCollection":for(n=[],r=0;r<e.features.length;r++)n.push(t(e.features[r],i));break;case"GeometryCollection":for(n=[],r=0;r<e.geometries.length;r++)n.push(t(e.geometries[r],i))}return n};function P(t,e){return C(t,e)}function R(t,e){return T(t,e)}function k(t){if("NaN"!==t.xmin&&"NaN"!==t.ymin&&"NaN"!==t.xmax&&"NaN"!==t.ymax){var e=Object(s.latLng)(t.ymin,t.xmin),i=Object(s.latLng)(t.ymax,t.xmax);return Object(s.latLngBounds)(e,i)}return null}function F(t){return{xmin:(t=Object(s.latLngBounds)(t)).getSouthWest().lng,ymin:t.getSouthWest().lat,xmax:t.getNorthEast().lng,ymax:t.getNorthEast().lat,spatialReference:{wkid:4326}}}var U=/^(OBJECTID|FID|OID|ID)$/i;function M(t){var e;if(t.objectIdFieldName)e=t.objectIdFieldName;else if(t.fields){for(var i=0;i<=t.fields.length-1;i++)if("esriFieldTypeOID"===t.fields[i].type){e=t.fields[i].name;break}if(!e)for(i=0;i<=t.fields.length-1;i++)if(t.fields[i].name.match(U)){e=t.fields[i].name;break}}return e}function j(t){for(var e in t.attributes)if(e.match(U))return e}function G(t,e){var i,r=t.features||t.results,s=r&&r.length;i=e||M(t);var n={type:"FeatureCollection",features:[]};if(s)for(var o=r.length-1;o>=0;o--){var a=R(r[o],i||j(r[o]));n.features.push(a)}return n}function E(t){return"/"!==(t=s.Util.trim(t))[t.length-1]&&(t+="/"),t}function D(t){if(-1!==t.url.indexOf("?")){t.requestParams=t.requestParams||{};var e=t.url.substring(t.url.indexOf("?")+1);t.url=t.url.split("?")[0],t.requestParams=JSON.parse('{"'+decodeURI(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}return t.url=E(t.url.split("?")[0]),t}function z(t){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(t)}function B(t){var e;switch(t){case"Point":e="esriGeometryPoint";break;case"MultiPoint":e="esriGeometryMultipoint";break;case"LineString":case"MultiLineString":e="esriGeometryPolyline";break;case"Polygon":case"MultiPolygon":e="esriGeometryPolygon"}return e}function q(t){return t.getSize().x-c.attributionWidthOffset+"px"}function Z(t){if(t.attributionControl){if(t.attributionControl._esriAttributionLayerCount||(t.attributionControl._esriAttributionLayerCount=0),0===t.attributionControl._esriAttributionLayerCount){if(!t.attributionControl._esriAttributionAddedOnce){var e=document.createElement("style");e.type="text/css",e.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(e);var i=document.createElement("style");i.type="text/css",i.innerHTML=".esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: "+q(t)+";}",document.getElementsByTagName("head")[0].appendChild(i),t.on("resize",(function(e){t.attributionControl&&(t.attributionControl._container.style.maxWidth=q(e.target))})),t.attributionControl._esriAttributionAddedOnce=!0}t.attributionControl.setPrefix('<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> | Powered by <a href="https://www.esri.com">Esri</a>'),s.DomUtil.addClass(t.attributionControl._container,"esri-truncated-attribution:hover"),s.DomUtil.addClass(t.attributionControl._container,"esri-truncated-attribution")}t.attributionControl._esriAttributionLayerCount=t.attributionControl._esriAttributionLayerCount+1}}function N(t){t.attributionControl&&(t.attributionControl._esriAttributionLayerCount&&1===t.attributionControl._esriAttributionLayerCount&&(t.attributionControl.setPrefix('<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'),s.DomUtil.removeClass(t.attributionControl._container,"esri-truncated-attribution:hover"),s.DomUtil.removeClass(t.attributionControl._container,"esri-truncated-attribution")),t.attributionControl._esriAttributionLayerCount=t.attributionControl._esriAttributionLayerCount-1)}function W(t){var e={geometry:null,geometryType:null};return t instanceof s.LatLngBounds?(e.geometry=F(t),e.geometryType="esriGeometryEnvelope",e):(t.getLatLng&&(t=t.getLatLng()),t instanceof s.LatLng&&(t={type:"Point",coordinates:[t.lng,t.lat]}),t instanceof s.GeoJSON&&(t=t.getLayers()[0].feature.geometry,e.geometry=P(t),e.geometryType=B(t.type)),t.toGeoJSON&&(t=t.toGeoJSON()),"Feature"===t.type&&(t=t.geometry),"Point"===t.type||"LineString"===t.type||"Polygon"===t.type||"MultiPolygon"===t.type?(e.geometry=P(t),e.geometryType=B(t.type),e):void v("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object"))}function J(t,e){l.cors&&y(t,{},s.Util.bind((function(t,i){if(!t){e._esriAttributions=[];for(var r=0;r<i.contributors.length;r++)for(var n=i.contributors[r],o=0;o<n.coverageAreas.length;o++){var a=n.coverageAreas[o],u=Object(s.latLng)(a.bbox[0],a.bbox[1]),l=Object(s.latLng)(a.bbox[2],a.bbox[3]);e._esriAttributions.push({attribution:n.attribution,score:a.score,bounds:Object(s.latLngBounds)(u,l),minZoom:a.zoomMin,maxZoom:a.zoomMax})}e._esriAttributions.sort((function(t,e){return e.score-t.score})),V({target:e})}}),this))}function V(t){var e=t.target,i=e._esriAttributions;if(e&&e.attributionControl){var r=e.attributionControl._container.querySelector(".esri-dynamic-attribution");if(r&&i){for(var n="",o=e.getBounds(),a=Object(s.latLngBounds)(o.getSouthWest().wrap(),o.getNorthEast().wrap()),u=e.getZoom(),l=0;l<i.length;l++){var c=i[l],p=c.attribution;!n.match(p)&&c.bounds.intersects(a)&&u>=c.minZoom&&u<=c.maxZoom&&(n+=", "+p)}n=n.substr(2),r.innerHTML=n,r.style.maxWidth=q(e),e.fire("attributionupdated",{attribution:n})}}}var Q={warn:v,cleanUrl:E,getUrlParams:D,isArcgisOnline:z,geojsonTypeToArcGIS:B,responseToFeatureCollection:G,geojsonToArcGIS:P,arcgisToGeoJSON:R,boundsToExtent:F,extentToBounds:k,calcAttributionWidth:q,setEsriAttribution:Z,_setGeometry:W,_getAttributionData:J,_updateMapAttribution:V,_findIdAttributeFromFeature:j,_findIdAttributeFromResponse:M},H=s.Class.extend({options:{proxy:!1,useCors:a},generateSetter:function(t,e){return s.Util.bind((function(e){return this.params[t]=e,this}),e)},initialize:function(t){if(t.request&&t.options?(this._service=t,s.Util.setOptions(this,t.options)):(s.Util.setOptions(this,t),this.options.url=E(t.url)),this.params=s.Util.extend({},this.params||{}),this.setters)for(var e in this.setters){var i=this.setters[e];this[e]=this.generateSetter(i,this)}},token:function(t){return this._service?this._service.authenticate(t):this.params.token=t,this},apikey:function(t){return this.token(t)},format:function(t){return this.params.returnUnformattedValues=!t,this},request:function(t,e){return this.options.requestParams&&s.Util.extend(this.params,this.options.requestParams),this._service?this._service.request(this.path,this.params,t,e):this._request("request",this.path,this.params,t,e)},_request:function(t,e,i,r,s){var n=this.options.proxy?this.options.proxy+"?"+this.options.url+e:this.options.url+e;return"get"!==t&&"request"!==t||this.options.useCors?b[t](n,i,r,s):b.get.JSONP(n,i,r,s)}});function K(t){return t=D(t),new H(t)}var X=H.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",returnM:"returnM",transform:"datumTransformation",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*"},within:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelContains",this},intersects:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelIntersects",this},contains:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelWithin",this},crosses:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelCrosses",this},touches:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelTouches",this},overlaps:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby:function(t,e){return t=Object(s.latLng)(t),this.params.geometry=[t.lng,t.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=e,this.params.inSR=4326,this},where:function(t){return this.params.where=t,this},between:function(t,e){return this.params.time=[t.valueOf(),e.valueOf()],this},simplify:function(t,e){var i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},orderBy:function(t,e){return e=e||"ASC",this.params.orderByFields=this.params.orderByFields?this.params.orderByFields+",":"",this.params.orderByFields+=[t,e].join(" "),this},run:function(t,e){return this._cleanParams(),this.options.isModern||z(this.options.url)&&void 0===this.options.isModern?(this.params.f="geojson",this.request((function(i,r){this._trapSQLerrors(i),t.call(e,i,r,r)}),this)):this.request((function(i,r){this._trapSQLerrors(i),t.call(e,i,r&&G(r),r)}),this)},count:function(t,e){return this._cleanParams(),this.params.returnCountOnly=!0,this.request((function(e,i){t.call(this,e,i&&i.count,i)}),e)},ids:function(t,e){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request((function(e,i){t.call(this,e,i&&i.objectIds,i)}),e)},bounds:function(t,e){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request((function(i,r){r&&r.extent&&k(r.extent)?t.call(e,i,k(r.extent),r):(i={message:"Invalid Bounds"},t.call(e,i,null,r))}),e)},distinct:function(){return this.params.returnGeometry=!1,this.params.returnDistinctValues=!0,this},pixelSize:function(t){var e=Object(s.point)(t);return this.params.pixelSize=[e.x,e.y],this},layer:function(t){return this.path=t+"/query",this},_trapSQLerrors:function(t){t&&"400"===t.code&&v("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams:function(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometryParams:function(t){this.params.inSR=4326;var e=W(t);this.params.geometry=e.geometry,this.params.geometryType=e.geometryType}});function Y(t){return new X(t)}var $=Y,tt=H.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs:function(t,e){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[t,e].join(":"),this},simplify:function(t,e){var i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},run:function(t,e){return this.request((function(i,r){t.call(e,i,r&&G(r),r)}),e)}});function et(t){return new tt(t)}var it=et,rt=H.extend({path:"identify",between:function(t,e){return this.params.time=[t.valueOf(),e.valueOf()],this}});function st(t){return new rt(t)}var nt=rt.extend({setters:{layers:"layers",precision:"geometryPrecision",tolerance:"tolerance",returnGeometry:"returnGeometry"},params:{sr:4326,layers:"all",tolerance:3,returnGeometry:!0},on:function(t){var e=F(t.getBounds()),i=t.getSize();return this.params.imageDisplay=[i.x,i.y,96],this.params.mapExtent=[e.xmin,e.ymin,e.xmax,e.ymax],this},at:function(t){return 2===t.length&&(t=Object(s.latLng)(t)),this._setGeometryParams(t),this},layerDef:function(t,e){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[t,e].join(":"),this},simplify:function(t,e){var i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},run:function(t,e){return this.request((function(i,r){if(i)t.call(e,i,void 0,r);else{var s=G(r);r.results=r.results.reverse();for(var n=0;n<s.features.length;n++){s.features[n].layerId=r.results[n].layerId}t.call(e,void 0,s,r)}}))},_setGeometryParams:function(t){var e=W(t);this.params.geometry=e.geometry,this.params.geometryType=e.geometryType}});function ot(t){return new nt(t)}var at=ot,ut=rt.extend({setters:{setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setPixelSize:"pixelSize",returnCatalogItems:"returnCatalogItems",returnGeometry:"returnGeometry"},params:{returnGeometry:!1},at:function(t){return t=Object(s.latLng)(t),this.params.geometry=JSON.stringify({x:t.lng,y:t.lat,spatialReference:{wkid:4326}}),this.params.geometryType="esriGeometryPoint",this},getMosaicRule:function(){return this.params.mosaicRule},getRenderingRule:function(){return this.params.renderingRule},getPixelSize:function(){return this.params.pixelSize},run:function(t,e){return this.request((function(i,r){t.call(e,i,r&&this._responseToGeoJSON(r),r)}),this)},_responseToGeoJSON:function(t){var e=t.location,i=t.catalogItems,r=t.catalogItemVisibilities,s={pixel:{type:"Feature",geometry:{type:"Point",coordinates:[e.x,e.y]},crs:{type:"EPSG",properties:{code:e.spatialReference.wkid}},properties:{OBJECTID:t.objectId,name:t.name,value:t.value},id:t.objectId}};if(t.properties&&t.properties.Values&&(s.pixel.properties.values=t.properties.Values),i&&i.features&&(s.catalogItems=G(i),r&&r.length===s.catalogItems.features.length))for(var n=r.length-1;n>=0;n--)s.catalogItems.features[n].properties.catalogItemVisibility=r[n];return s}});function lt(t){return new ut(t)}var ct=lt,pt=s.Evented.extend({options:{proxy:!1,useCors:a,timeout:0},initialize:function(t){t=t||{},this._requestQueue=[],this._authenticating=!1,s.Util.setOptions(this,t),this.options.url=E(this.options.url)},get:function(t,e,i,r){return this._request("get",t,e,i,r)},post:function(t,e,i,r){return this._request("post",t,e,i,r)},request:function(t,e,i,r){return this._request("request",t,e,i,r)},metadata:function(t,e){return this._request("get","",{},t,e)},authenticate:function(t){return this._authenticating=!1,this.options.token=t,this._runQueue(),this},getTimeout:function(){return this.options.timeout},setTimeout:function(t){this.options.timeout=t},_request:function(t,e,i,r,n){this.fire("requeststart",{url:this.options.url+e,params:i,method:t},!0);var o=this._createServiceCallback(t,e,i,r,n);if(this.options.token&&(i.token=this.options.token),this.options.requestParams&&s.Util.extend(i,this.options.requestParams),!this._authenticating){var a=this.options.proxy?this.options.proxy+"?"+this.options.url+e:this.options.url+e;return"get"!==t&&"request"!==t||this.options.useCors?b[t](a,i,o,n):b.get.JSONP(a,i,o,n)}this._requestQueue.push([t,e,i,r,n])},_createServiceCallback:function(t,e,i,r,n){return s.Util.bind((function(o,a){!o||499!==o.code&&498!==o.code||(this._authenticating=!0,this._requestQueue.push([t,e,i,r,n]),this.fire("authenticationrequired",{authenticate:s.Util.bind(this.authenticate,this)},!0),o.authenticate=s.Util.bind(this.authenticate,this)),r.call(n,o,a),o?this.fire("requesterror",{url:this.options.url+e,params:i,message:o.message,code:o.code,method:t},!0):this.fire("requestsuccess",{url:this.options.url+e,params:i,response:a,method:t},!0),this.fire("requestend",{url:this.options.url+e,params:i,method:t},!0)}),this)},_runQueue:function(){for(var t=this._requestQueue.length-1;t>=0;t--){var e=this._requestQueue[t];this[e.shift()].apply(this,e)}this._requestQueue=[]}});function ht(t){return t=D(t),new pt(t)}var ft=pt.extend({identify:function(){return at(this)},find:function(){return it(this)},query:function(){return $(this)}});function dt(t){return new ft(t)}var mt=dt,yt=pt.extend({query:function(){return $(this)},identify:function(){return ct(this)}});function gt(t){return new yt(t)}var _t=gt,vt=pt.extend({options:{idAttribute:"OBJECTID"},query:function(){return $(this)},addFeature:function(t,e,i){this.addFeatures(t,e,i)},addFeatures:function(t,e,i){for(var r=t.features?t.features:[t],s=r.length-1;s>=0;s--)delete r[s].id;return t=P(t),t=r.length>1?t:[t],this.post("addFeatures",{features:t},(function(t,r){var s=r&&r.addResults?r.addResults.length>1?r.addResults:r.addResults[0]:void 0;e&&e.call(i,t||r.addResults[0].error,s)}),i)},updateFeature:function(t,e,i){this.updateFeatures(t,e,i)},updateFeatures:function(t,e,i){var r=t.features?t.features:[t];return t=P(t,this.options.idAttribute),t=r.length>1?t:[t],this.post("updateFeatures",{features:t},(function(t,r){var s=r&&r.updateResults?r.updateResults.length>1?r.updateResults:r.updateResults[0]:void 0;e&&e.call(i,t||r.updateResults[0].error,s)}),i)},deleteFeature:function(t,e,i){this.deleteFeatures(t,e,i)},deleteFeatures:function(t,e,i){return this.post("deleteFeatures",{objectIds:t},(function(t,r){var s=r&&r.deleteResults?r.deleteResults.length>1?r.deleteResults:r.deleteResults[0]:void 0;e&&e.call(i,t||r.deleteResults[0].error,s)}),i)}});function bt(t){return new vt(t)}var xt=bt,Lt="https:"!==window.location.protocol?"http:":"https:",St=s.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map"}},Topographic:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map"}},Oceans:{urlTemplate:Lt+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap"}},OceansLabels:{urlTemplate:Lt+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:u?"esri-labels":"tilePane",attribution:""}},NationalGeographic:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"National Geographic, DeLorme, HERE, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, increment P Corp."}},DarkGray:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},DarkGrayLabels:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:u?"esri-labels":"tilePane",attribution:""}},Gray:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},GrayLabels:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:u?"esri-labels":"tilePane",attribution:""}},Imagery:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}},ImageryLabels:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:u?"esri-labels":"tilePane",attribution:""}},ImageryTransportation:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:u?"esri-labels":"tilePane",attribution:""}},ShadedRelief:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS"}},ShadedReliefLabels:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:12,subdomains:["server","services"],pane:u?"esri-labels":"tilePane",attribution:""}},Terrain:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS, NOAA"}},TerrainLabels:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],pane:u?"esri-labels":"tilePane",attribution:""}},USATopo:{urlTemplate:Lt+"//{s}.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:15,subdomains:["server","services"],attribution:"USGS, National Geographic Society, i-cubed"}},ImageryClarity:{urlTemplate:Lt+"//clarity.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"}},Physical:{urlTemplate:Lt+"//{s}.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:8,subdomains:["server","services"],attribution:"U.S. National Park Service"}},ImageryFirefly:{urlTemplate:Lt+"//fly.maptiles.arcgis.com/arcgis/rest/services/World_Imagery_Firefly/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}}}},initialize:function(t,e){var i;if("object"==typeof t&&t.urlTemplate&&t.options)i=t;else{if("string"!=typeof t||!St.TILES[t])throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Physical", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ImageryClarity", "ImageryFirefly", ShadedRelief", "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"');i=St.TILES[t]}var r=s.Util.extend(i.options,e);s.Util.setOptions(this,r),this.options.ignoreDeprecationWarning||console.warn("WARNING: L.esri.BasemapLayer uses data services that are in mature support and are not being updated. Please use L.esri.Vector.vectorBasemapLayer instead. More info: https://esriurl.com/esri-leaflet-basemap"),this.options.token&&-1===i.urlTemplate.indexOf("token=")&&(i.urlTemplate+="?token="+this.options.token),this.options.proxy&&(i.urlTemplate=this.options.proxy+"?"+i.urlTemplate),s.TileLayer.prototype.initialize.call(this,i.urlTemplate,r)},onAdd:function(t){Z(t),"esri-labels"===this.options.pane&&this._initPane(),this.options.attributionUrl&&J((this.options.proxy?this.options.proxy+"?":"")+this.options.attributionUrl,t),t.on("moveend",V),s.TileLayer.prototype.onAdd.call(this,t)},onRemove:function(t){N(t),t.off("moveend",V),s.TileLayer.prototype.onRemove.call(this,t)},_initPane:function(){if(!this._map.getPane(this.options.pane)){var t=this._map.createPane(this.options.pane);t.style.pointerEvents="none",t.style.zIndex=500}},getAttribution:function(){if(this.options.attribution)var t='<span class="esri-dynamic-attribution">'+this.options.attribution+"</span>";return t}});function At(t,e){return new St(t,e)}var wt=s.TileLayer.extend({options:{zoomOffsetAllowance:.1,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=="},statics:{MercatorZoomLevels:{0:156543.033928,1:78271.5169639999,2:39135.7584820001,3:19567.8792409999,4:9783.93962049996,5:4891.96981024998,6:2445.98490512499,7:1222.99245256249,8:611.49622628138,9:305.748113140558,10:152.874056570411,11:76.4370282850732,12:38.2185141425366,13:19.1092570712683,14:9.55462853563415,15:4.77731426794937,16:2.38865713397468,17:1.19432856685505,18:.597164283559817,19:.298582141647617,20:.14929107082381,21:.07464553541191,22:.0373227677059525,23:.0186613838529763}},initialize:function(t){t=D(t=s.Util.setOptions(this,t)),this.tileUrl=(t.proxy?t.proxy+"?":"")+t.url+"tile/{z}/{y}/{x}"+(t.requestParams&&Object.keys(t.requestParams).length>0?s.Util.getParamString(t.requestParams):""),-1!==t.url.indexOf("{s}")&&t.subdomains&&(t.url=t.url.replace("{s}",t.subdomains[0])),this.service=mt(t),this.service.addEventParent(this),new RegExp(/tiles.arcgis(online)?\.com/g).test(t.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),t.subdomains=["1","2","3","4"]),this.options.token&&(this.tileUrl+="?token="+this.options.token),s.TileLayer.prototype.initialize.call(this,this.tileUrl,t)},getTileUrl:function(t){var e=this._getZoomForUrl();return s.Util.template(this.tileUrl,s.Util.extend({s:this._getSubdomain(t),x:t.x,y:t.y,z:this._lodMap&&this._lodMap[e]?this._lodMap[e]:e},this.options))},createTile:function(t,e){var i=document.createElement("img");return s.DomEvent.on(i,"load",s.Util.bind(this._tileOnLoad,this,e,i)),s.DomEvent.on(i,"error",s.Util.bind(this._tileOnError,this,e,i)),this.options.crossOrigin&&(i.crossOrigin=""),i.alt="",!this._lodMap||this._lodMap&&this._lodMap[this._getZoomForUrl()]?i.src=this.getTileUrl(t):this.once("lodmap",(function(){i.src=this.getTileUrl(t)}),this),i},onAdd:function(t){Z(t),this._lodMap||this.metadata((function(e,i){if(!e&&i.spatialReference){var r=i.spatialReference.latestWkid||i.spatialReference.wkid;if(!this.options.attribution&&t.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,t.attributionControl.addAttribution(this.getAttribution())),t.options.crs!==s.CRS.EPSG3857||102100!==r&&3857!==r)t.options.crs&&t.options.crs.code&&t.options.crs.code.indexOf(r)>-1||v("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet http://esri.github.io/esri-leaflet/examples/non-mercator-projection.html");else{this._lodMap={};for(var n=i.tileInfo.lods,o=wt.MercatorZoomLevels,a=0;a<n.length;a++){var u=n[a];for(var l in o){var c=o[l];if(this._withinPercentage(u.resolution,c,this.options.zoomOffsetAllowance)){this._lodMap[l]=u.level;break}}}this.fire("lodmap")}}}),this),s.TileLayer.prototype.onAdd.call(this,t)},onRemove:function(t){N(t),s.TileLayer.prototype.onRemove.call(this,t)},metadata:function(t,e){return this.service.metadata(t,e),this},identify:function(){return this.service.identify()},find:function(){return this.service.find()},query:function(){return this.service.query()},authenticate:function(t){var e="?token="+t;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,e):this.tileUrl+e,this.options.token=t,this.service.authenticate(t),this},_withinPercentage:function(t,e,i){return Math.abs(t/e-1)<i}});function It(t,e){return new wt(t,e)}var Tt=s.ImageOverlay.extend({onAdd:function(t){this._topLeft=t.getPixelBounds().min,s.ImageOverlay.prototype.onAdd.call(this,t)},_reset:function(){this._map.options.crs===s.CRS.EPSG3857?s.ImageOverlay.prototype._reset.call(this):s.DomUtil.setPosition(this._image,this._topLeft.subtract(this._map.getPixelOrigin()))}}),Ot=s.Layer.extend({options:{opacity:1,position:"front",f:"image",useCors:a,attribution:null,interactive:!1,alt:""},onAdd:function(t){Z(t),this.options.zIndex&&(this.options.position=null),this._update=s.Util.throttle(this._update,this.options.updateInterval,this),t.on("moveend",this._update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?t.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this._update(),this._popup&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this.metadata((function(e,i){!e&&!this.options.attribution&&t.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,t.attributionControl.addAttribution(this.getAttribution()))}),this)},onRemove:function(t){N(t),this._currentImage&&this._map.removeLayer(this._currentImage),this._popup&&(this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._map.off("moveend",this._update,this)},bindPopup:function(t,e){return this._shouldRenderPopup=!1,this._lastClick=!1,this._popup=Object(s.popup)(e),this._popupFunction=t,this._map&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this},unbindPopup:function(){return this._map&&(this._map.closePopup(this._popup),this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._popup=!1,this},bringToFront:function(){return this.options.position="front",this._currentImage&&(this._currentImage.bringToFront(),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this.options.position="back",this._currentImage&&(this._currentImage.bringToBack(),this._setAutoZIndex(Math.min)),this},setZIndex:function(t){return this.options.zIndex=t,this._currentImage&&this._currentImage.setZIndex(t),this},_setAutoZIndex:function(t){if(this._currentImage){for(var e,i=this._currentImage.getPane().children,r=-t(-1/0,1/0),s=0,n=i.length;s<n;s++)e=i[s].style.zIndex,i[s]!==this._currentImage._image&&e&&(r=t(r,+e));isFinite(r)&&(this.options.zIndex=r+t(-1,1),this.setZIndex(this.options.zIndex))}},getAttribution:function(){return this.options.attribution},getOpacity:function(){return this.options.opacity},setOpacity:function(t){return this.options.opacity=t,this._currentImage&&this._currentImage.setOpacity(t),this},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(t,e){return this.options.from=t,this.options.to=e,this._update(),this},metadata:function(t,e){return this.service.metadata(t,e),this},authenticate:function(t){return this.service.authenticate(t),this},redraw:function(){this._update()},_renderImage:function(t,e,i){if(this._map){if(i&&(t="data:"+i+";base64,"+t),!t)return;var r=new Tt(t,e,{opacity:0,crossOrigin:this.options.withCredentials?"use-credentials":this.options.useCors,alt:this.options.alt,pane:this.options.pane||this.getPane(),interactive:this.options.interactive}).addTo(this._map),s=function(t){if(r.off("error",s,this),this._map){var i=t.target,n=this._currentImage;i._bounds.equals(e)&&i._bounds.equals(this._map.getBounds())?(this._currentImage=i,"front"===this.options.position?this.bringToFront():"back"===this.options.position&&this.bringToBack(),this.options.zIndex&&this.setZIndex(this.options.zIndex),this._map&&this._currentImage._map?this._currentImage.setOpacity(this.options.opacity):this._currentImage._map.removeLayer(this._currentImage),n&&this._map&&this._map.removeLayer(n),n&&n._map&&n._map.removeLayer(n)):this._map.removeLayer(i)}this.fire("load",{bounds:e})};r.once("error",(function(){this._map.removeLayer(r),this.fire("error"),r.off("load",s,this)}),this),r.once("load",s,this)}},_update:function(){if(this._map){var t=this._map.getZoom(),e=this._map.getBounds();if(!(this._animatingZoom||this._map._panTransition&&this._map._panTransition._inProgress))if(t>this.options.maxZoom||t<this.options.minZoom)this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null);else{var i=this._buildExportParams();s.Util.extend(i,this.options.requestParams),i?(this._requestExport(i,e),this.fire("loading",{bounds:e})):this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null)}}},_renderPopup:function(t,e,i,r){if(t=Object(s.latLng)(t),this._shouldRenderPopup&&this._lastClick.equals(t)){var n=this._popupFunction(e,i,r);n&&this._popup.setLatLng(t).setContent(n).openOn(this._map)}},_resetPopupState:function(t){this._shouldRenderPopup=!1,this._lastClick=t.latlng},_calculateBbox:function(){var t=this._map.getPixelBounds(),e=this._map.unproject(t.getBottomLeft()),i=this._map.unproject(t.getTopRight()),r=this._map.options.crs.project(i),n=this._map.options.crs.project(e),o=Object(s.bounds)(r,n);return[o.getBottomLeft().x,o.getBottomLeft().y,o.getTopRight().x,o.getTopRight().y].join(",")},_calculateImageSize:function(){var t=this._map.getPixelBounds(),e=this._map.getSize(),i=this._map.unproject(t.getBottomLeft()),r=this._map.unproject(t.getTopRight()),s=this._map.latLngToLayerPoint(r).y,n=this._map.latLngToLayerPoint(i).y;return(s>0||n<e.y)&&(e.y=n-s),e.x+","+e.y}}),Ct=Ot.extend({options:{updateInterval:150,format:"jpgpng",transparent:!0,f:"image"},query:function(){return this.service.query()},identify:function(){return this.service.identify()},initialize:function(t){t=D(t),this.service=_t(t),this.service.addEventParent(this),s.Util.setOptions(this,t)},setPixelType:function(t){return this.options.pixelType=t,this._update(),this},getPixelType:function(){return this.options.pixelType},setBandIds:function(t){return s.Util.isArray(t)?this.options.bandIds=t.join(","):this.options.bandIds=t.toString(),this._update(),this},getBandIds:function(){return this.options.bandIds},setNoData:function(t,e){return s.Util.isArray(t)?this.options.noData=t.join(","):this.options.noData=t.toString(),e&&(this.options.noDataInterpretation=e),this._update(),this},getNoData:function(){return this.options.noData},getNoDataInterpretation:function(){return this.options.noDataInterpretation},setRenderingRule:function(t){this.options.renderingRule=t,this._update()},getRenderingRule:function(){return this.options.renderingRule},setMosaicRule:function(t){this.options.mosaicRule=t,this._update()},getMosaicRule:function(){return this.options.mosaicRule},_getPopupData:function(t){var e=s.Util.bind((function(e,i,r){e||setTimeout(s.Util.bind((function(){this._renderPopup(t.latlng,e,i,r)}),this),300)}),this),i=this.identify().at(t.latlng);this.options.mosaicRule&&i.setMosaicRule(this.options.mosaicRule),i.run(e),this._shouldRenderPopup=!0,this._lastClick=t.latlng},_buildExportParams:function(){var t=parseInt(this._map.options.crs.code.split(":")[1],10),e={bbox:this._calculateBbox(),size:this._calculateImageSize(),format:this.options.format,transparent:this.options.transparent,bboxSR:t,imageSR:t};return this.options.from&&this.options.to&&(e.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.options.pixelType&&(e.pixelType=this.options.pixelType),this.options.interpolation&&(e.interpolation=this.options.interpolation),this.options.compressionQuality&&(e.compressionQuality=this.options.compressionQuality),this.options.bandIds&&(e.bandIds=this.options.bandIds),(0===this.options.noData||this.options.noData)&&(e.noData=this.options.noData),this.options.noDataInterpretation&&(e.noDataInterpretation=this.options.noDataInterpretation),this.service.options.token&&(e.token=this.service.options.token),this.options.renderingRule&&(e.renderingRule=JSON.stringify(this.options.renderingRule)),this.options.mosaicRule&&(e.mosaicRule=JSON.stringify(this.options.mosaicRule)),e},_requestExport:function(t,e){if("json"===this.options.f)this.service.request("exportImage",t,(function(t,i){t||(this.options.token&&(i.href+="?token="+this.options.token),this.options.proxy&&(i.href=this.options.proxy+"?"+i.href),this._renderImage(i.href,e))}),this);else{t.f="image";var i=this.options.url+"exportImage"+s.Util.getParamString(t);this.options.proxy&&(i=this.options.proxy+"?"+i),this._renderImage(i,e)}}});function Pt(t,e){return new Ct(t,e)}var Rt=Ot.extend({options:{updateInterval:150,layers:!1,layerDefs:!1,timeOptions:!1,format:"png32",transparent:!0,f:"json"},initialize:function(t){t=D(t),this.service=mt(t),this.service.addEventParent(this),s.Util.setOptions(this,t)},getDynamicLayers:function(){return this.options.dynamicLayers},setDynamicLayers:function(t){return this.options.dynamicLayers=t,this._update(),this},getLayers:function(){return this.options.layers},setLayers:function(t){return this.options.layers=t,this._update(),this},getLayerDefs:function(){return this.options.layerDefs},setLayerDefs:function(t){return this.options.layerDefs=t,this._update(),this},getTimeOptions:function(){return this.options.timeOptions},setTimeOptions:function(t){return this.options.timeOptions=t,this._update(),this},query:function(){return this.service.query()},identify:function(){return this.service.identify()},find:function(){return this.service.find()},_getPopupData:function(t){var e,i=s.Util.bind((function(e,i,r){e||setTimeout(s.Util.bind((function(){this._renderPopup(t.latlng,e,i,r)}),this),300)}),this);if((e=this.options.popup?this.options.popup.on(this._map).at(t.latlng):this.identify().on(this._map).at(t.latlng)).params.maxAllowableOffset||e.simplify(this._map,.5),this.options.popup&&this.options.popup.params&&this.options.popup.params.layers||(this.options.layers?e.layers("visible:"+this.options.layers.join(",")):e.layers("visible")),this.options.layerDefs&&"string"!=typeof this.options.layerDefs&&!e.params.layerDefs)for(var r in this.options.layerDefs)this.options.layerDefs.hasOwnProperty(r)&&e.layerDef(r,this.options.layerDefs[r]);e.run(i),this._shouldRenderPopup=!0,this._lastClick=t.latlng},_buildExportParams:function(){var t=parseInt(this._map.options.crs.code.split(":")[1],10),e={bbox:this._calculateBbox(),size:this._calculateImageSize(),dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:t,imageSR:t};if(this.options.dynamicLayers&&(e.dynamicLayers=this.options.dynamicLayers),this.options.layers){if(0===this.options.layers.length)return;e.layers="show:"+this.options.layers.join(",")}return this.options.layerDefs&&(e.layerDefs="string"==typeof this.options.layerDefs?this.options.layerDefs:JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(e.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(e.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.service.options.token&&(e.token=this.service.options.token),this.options.proxy&&(e.proxy=this.options.proxy),this.options.disableCache&&(e._ts=Date.now()),e},_requestExport:function(t,e){if("json"===this.options.f)this.service.request("export",t,(function(t,i){t||(this.options.token&&i.href&&(i.href+="?token="+this.options.token),this.options.proxy&&i.href&&(i.href=this.options.proxy+"?"+i.href),i.href?this._renderImage(i.href,e):this._renderImage(i.imageData,e,i.contentType))}),this);else{t.f="image";var i=this.options.url+"export"+s.Util.getParamString(t);this.options.proxy&&(i=this.options.proxy+"?"+i),this._renderImage(i,e)}}});function kt(t,e){return new Rt(t,e)}var Ft=s.Layer.extend({options:{cellSize:512,updateWhenIdle:s.Browser.mobile,updateInterval:150,noWrap:!1,keepBuffer:1.5},initialize:function(t){s.Util.setOptions(this,t)},onAdd:function(t){this._cells={},this._activeCells={},this._resetView(),this._update()},onRemove:function(t){this._removeAllCells(),this._cellZoom=void 0},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllCells(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=s.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),t},createCell:function(){return document.createElement("div")},removeCell:function(){},reuseCell:function(){},cellLeave:function(){},cellEnter:function(){},getCellSize:function(){var t=this.options.cellSize;return t instanceof s.Point?t:new s.Point(t,t)},_pruneCells:function(){if(this._map){var t,e;for(t in this._cells)(e=this._cells[t]).retain=e.current;for(t in this._cells)if((e=this._cells[t]).current&&!e.active){var i=e.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(t in this._cells)this._cells[t].retain||this._removeCell(t)}},_removeAllCells:function(){for(var t in this._cells)this._removeCell(t)},_invalidateAll:function(){this._removeAllCells(),this._cellZoom=void 0},_retainParent:function(t,e,i,r){var n=Math.floor(t/2),o=Math.floor(e/2),a=i-1,u=new s.Point(+n,+o);u.z=+a;var l=this._cellCoordsToKey(u),c=this._cells[l];return c&&c.active?(c.retain=!0,!0):(c&&c.loaded&&(c.retain=!0),a>r&&this._retainParent(n,o,a,r))},_retainChildren:function(t,e,i,r){for(var n=2*t;n<2*t+2;n++)for(var o=2*e;o<2*e+2;o++){var a=new s.Point(n,o);a.z=i+1;var u=this._cellCoordsToKey(a),l=this._cells[u];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),i+1<r&&this._retainChildren(n,o,i+1,r))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);e||this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_setView:function(t,e,i,r){var s=Math.round(e);r||(this._cellZoom=s,this._abortLoading&&this._abortLoading(),this._resetGrid(),void 0!==s&&this._update(t),i||this._pruneCells(),this._noPrune=!!i)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._cellSize=this.getCellSize(),r=this._cellZoom,s=this._map.getPixelWorldBounds(this._cellZoom);s&&(this._globalCellRange=this._pxBoundsToCellRange(s)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],r).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],r).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],r).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],r).y/i.y)]},_onMoveEnd:function(t){t&&(t.pinch||t.flyTo)||!this._map||this._map._animatingZoom||this._update()},_getCelldPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),r=e.getZoomScale(i,this._cellZoom),n=e.project(t,this._cellZoom).floor(),o=e.getSize().divideBy(2*r);return new s.Bounds(n.subtract(o),n.add(o))},_update:function(t){var e=this._map;if(e){var i=Math.round(e.getZoom());void 0===t&&(t=e.getCenter());var r=this._getCelldPixelBounds(t),n=this._pxBoundsToCellRange(r),o=n.getCenter(),a=[],u=this.options.keepBuffer,l=new s.Bounds(n.getBottomLeft().subtract([u,-u]),n.getTopRight().add([u,-u]));if(!(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.max.x)&&isFinite(n.max.y)))throw new Error("Attempted to load an infinite number of cells");for(var c in this._cells){var p=this._cells[c].coords;p.z===this._cellZoom&&l.contains(new s.Point(p.x,p.y))||(this._cells[c].current=!1)}if(Math.abs(i-this._cellZoom)>1)this._setView(t,i);else{for(var h=n.min.y;h<=n.max.y;h++)for(var f=n.min.x;f<=n.max.x;f++){var d=new s.Point(f,h);if(d.z=this._cellZoom,this._isValidCell(d)){var m=this._cells[this._cellCoordsToKey(d)];m?m.current=!0:a.push(d)}}if(a.sort((function(t,e){return t.distanceTo(o)-e.distanceTo(o)})),0!==a.length)for(this._loading||(this._loading=!0),f=0;f<a.length;f++){var y=this._cellCoordsToKey(a[f]),g=this._keyToCellCoords(y);this._activeCells[g]?this._reuseCell(a[f]):this._createCell(a[f])}}}},_isValidCell:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalCellRange;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;var r=this._cellCoordsToBounds(t);return Object(s.toLatLngBounds)(this.options.bounds).overlaps(r)},_keyToBounds:function(t){return this._cellCoordsToBounds(this._keyToCellCoords(t))},_cellCoordsToNwSe:function(t){var e=this._map,i=this.getCellSize(),r=t.scaleBy(i),s=r.add(i);return[e.unproject(r,t.z),e.unproject(s,t.z)]},_cellCoordsToBounds:function(t){var e=this._cellCoordsToNwSe(t),i=new s.LatLngBounds(e[0],e[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_cellCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToCellCoords:function(t){var e=t.split(":"),i=new s.Point(+e[0],+e[1]);return i.z=+e[2],i},_removeCell:function(t){var e=this._cells[t];if(e){var i=this._keyToCellCoords(t),r=this._wrapCoords(i),s=this._cellCoordsToBounds(this._wrapCoords(i));e.current=!1,delete this._cells[t],this._activeCells[t]=e,this.cellLeave(s,r,t),this.fire("cellleave",{key:t,coords:r,bounds:s})}},_reuseCell:function(t){var e=this._cellCoordsToKey(t);this._cells[e]=this._activeCells[e],this._cells[e].current=!0;var i=this._wrapCoords(t),r=this._cellCoordsToBounds(this._wrapCoords(t));this.cellEnter(r,i,e),this.fire("cellenter",{key:e,coords:i,bounds:r})},_createCell:function(t){var e=this._cellCoordsToKey(t),i=this._wrapCoords(t),r=this._cellCoordsToBounds(this._wrapCoords(t));this.createCell(r,i,e),this.fire("cellcreate",{key:e,coords:i,bounds:r}),this._cells[e]={coords:t,current:!0},s.Util.requestAnimFrame(this._pruneCells,this)},_cellReady:function(t,e,i){var r=this._cellCoordsToKey(t);(i=this._cells[r])&&(i.loaded=+new Date,i.active=!0)},_getCellPos:function(t){return t.scaleBy(this.getCellSize())},_wrapCoords:function(t){var e=new s.Point(this._wrapX?s.Util.wrapNum(t.x,this._wrapX):t.x,this._wrapY?s.Util.wrapNum(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToCellRange:function(t){var e=this.getCellSize();return new s.Bounds(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))}});function Ut(t){this.values=[].concat(t||[])}Ut.prototype.query=function(t){var e=this.getIndex(t);return this.values[e]},Ut.prototype.getIndex=function(t){this.dirty&&this.sort();for(var e,i,r=0,s=this.values.length-1;r<=s;)if(e=(r+s)/2|0,+(i=this.values[Math.round(e)]).value<+t)r=e+1;else{if(!(+i.value>+t))return e;s=e-1}return Math.abs(~s)},Ut.prototype.between=function(t,e){var i=this.getIndex(t),r=this.getIndex(e);if(0===i&&0===r)return[];for(;this.values[i-1]&&this.values[i-1].value===t;)i--;for(;this.values[r+1]&&this.values[r+1].value===e;)r++;return this.values[r]&&this.values[r].value===e&&this.values[r+1]&&r++,this.values.slice(i,r)},Ut.prototype.insert=function(t){return this.values.splice(this.getIndex(t.value),0,t),this},Ut.prototype.bulkAdd=function(t,e){return this.values=this.values.concat([].concat(t||[])),e?this.sort():this.dirty=!0,this},Ut.prototype.sort=function(){return this.values.sort((function(t,e){return+e.value-+t.value})).reverse(),this.dirty=!1,this};var Mt=Ut,jt=Ft.extend({options:{attribution:null,where:"1=1",fields:["*"],from:!1,to:!1,timeField:!1,timeFilterMode:"server",simplifyFactor:0,precision:6,fetchAllFeatures:!1},initialize:function(t){if(Ft.prototype.initialize.call(this,t),t=D(t),t=s.Util.setOptions(this,t),this.service=xt(t),this.service.addEventParent(this),"*"!==this.options.fields[0]){for(var e=!1,i=0;i<this.options.fields.length;i++)this.options.fields[i].match(/^(OBJECTID|FID|OID|ID)$/i)&&(e=!0);!1===e&&v("no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.")}this.options.timeField.start&&this.options.timeField.end?(this._startTimeIndex=new Mt,this._endTimeIndex=new Mt):this.options.timeField&&(this._timeIndex=new Mt),this._cache={},this._currentSnapshot=[],this._activeRequests=0},onAdd:function(t){return Z(t),this.service.metadata((function(e,i){if(!e){var r=i.supportedQueryFormats,s=!1;(!1===this.service.options.isModern||this.options.fetchAllFeatures)&&(s=!0),!s&&r&&-1!==r.indexOf("geoJSON")&&(this.service.options.isModern=!0),i.objectIdField&&(this.service.options.idAttribute=i.objectIdField),!this.options.attribution&&t.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,t.attributionControl.addAttribution(this.getAttribution()))}}),this),t.on("zoomend",this._handleZoomChange,this),Ft.prototype.onAdd.call(this,t)},onRemove:function(t){return N(t),t.off("zoomend",this._handleZoomChange,this),Ft.prototype.onRemove.call(this,t)},getAttribution:function(){return this.options.attribution},createCell:function(t,e){this._visibleZoom()&&this._requestFeatures(t,e)},_requestFeatures:function(t,e,i,r){this._activeRequests++,r=r||0;var n=this.options.where;return 1===this._activeRequests&&this.fire("loading",{bounds:t},!0),this._buildQuery(t,r).run((function(o,a,u){u&&u.exceededTransferLimit&&this.fire("drawlimitexceeded"),this.options.where===n&&(!o&&a&&a.features.length&&s.Util.requestAnimFrame(s.Util.bind((function(){this._addFeatures(a.features,e),this._postProcessFeatures(t)}),this)),o||!a||a.features.length||this._postProcessFeatures(t),o&&this._postProcessFeatures(t),i&&i.call(this,o,a),u&&(u.exceededTransferLimit||u.properties&&u.properties.exceededTransferLimit)&&this.options.fetchAllFeatures&&this._requestFeatures(t,e,i,r+a.features.length))}),this)},_postProcessFeatures:function(t){this._activeRequests--,this._activeRequests<=0&&this.fire("load",{bounds:t})},_cacheKey:function(t){return t.z+":"+t.x+":"+t.y},_addFeatures:function(t,e){if(e){var i=this._cacheKey(e);this._cache[i]=this._cache[i]||[]}for(var r=t.length-1;r>=0;r--){var s=t[r].id;-1===this._currentSnapshot.indexOf(s)&&this._currentSnapshot.push(s),void 0!==i&&-1===this._cache[i].indexOf(s)&&this._cache[i].push(s)}this.options.timeField&&this._buildTimeIndexes(t),this.createLayers(t)},_buildQuery:function(t,e){var i=this.service.query().intersects(t).where(this.options.where).fields(this.options.fields).precision(this.options.precision);return this.options.fetchAllFeatures&&!isNaN(parseInt(e))&&(i=i.offset(e)),i.params.resultType="tile",this.options.requestParams&&s.Util.extend(i.params,this.options.requestParams),this.options.simplifyFactor&&i.simplify(this._map,this.options.simplifyFactor),"server"===this.options.timeFilterMode&&this.options.from&&this.options.to&&i.between(this.options.from,this.options.to),i},setWhere:function(t,e,i){this.options.where=t&&t.length?t:"1=1";for(var r=[],n=[],o=0,a=null,u=s.Util.bind((function(u,l){if(u&&(a=u),l)for(var c=l.features.length-1;c>=0;c--)n.push(l.features[c].id);--o<=0&&this._visibleZoom()&&t===this.options.where&&(this._currentSnapshot=n,s.Util.requestAnimFrame(s.Util.bind((function(){this.removeLayers(r),this.addLayers(n),e&&e.call(i,a)}),this)))}),this),l=this._currentSnapshot.length-1;l>=0;l--)r.push(this._currentSnapshot[l]);for(var c in this._cache={},this._cells){o++;var p=this._keyToCellCoords(c),h=this._cellCoordsToBounds(p);this._requestFeatures(h,p,u)}return this},getWhere:function(){return this.options.where},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(t,e,i,r){var n=this.options.from,o=this.options.to,a=0,u=null,l=s.Util.bind((function(s){s&&(u=s),this._filterExistingFeatures(n,o,t,e),a--,i&&a<=0&&i.call(r,u)}),this);if(this.options.from=t,this.options.to=e,this._filterExistingFeatures(n,o,t,e),"server"===this.options.timeFilterMode)for(var c in this._cells){a++;var p=this._keyToCellCoords(c),h=this._cellCoordsToBounds(p);this._requestFeatures(h,p,l)}return this},refresh:function(){this.setWhere(this.options.where)},_filterExistingFeatures:function(t,e,i,r){var n=t&&e?this._getFeaturesInTimeRange(t,e):this._currentSnapshot,o=this._getFeaturesInTimeRange(i,r);if(o.indexOf)for(var a=0;a<o.length;a++){var u=n.indexOf(o[a]);u>=0&&n.splice(u,1)}s.Util.requestAnimFrame(s.Util.bind((function(){this.removeLayers(n),this.addLayers(o)}),this))},_getFeaturesInTimeRange:function(t,e){var i,r=[];if(this.options.timeField.start&&this.options.timeField.end){var s=this._startTimeIndex.between(t,e),n=this._endTimeIndex.between(t,e);i=s.concat(n)}else{if(!this._timeIndex)return v("You must set timeField in the layer constructor in order to manipulate the start and end time filter."),[];i=this._timeIndex.between(t,e)}for(var o=i.length-1;o>=0;o--)r.push(i[o].id);return r},_buildTimeIndexes:function(t){var e,i;if(this.options.timeField.start&&this.options.timeField.end){var r=[],s=[];for(e=t.length-1;e>=0;e--)i=t[e],r.push({id:i.id,value:new Date(i.properties[this.options.timeField.start])}),s.push({id:i.id,value:new Date(i.properties[this.options.timeField.end])});this._startTimeIndex.bulkAdd(r),this._endTimeIndex.bulkAdd(s)}else{var n=[];for(e=t.length-1;e>=0;e--)i=t[e],n.push({id:i.id,value:new Date(i.properties[this.options.timeField])});this._timeIndex.bulkAdd(n)}},_featureWithinTimeRange:function(t){if(!this.options.from||!this.options.to)return!0;var e=+this.options.from.valueOf(),i=+this.options.to.valueOf();if("string"==typeof this.options.timeField){var r=+t.properties[this.options.timeField];return r>=e&&r<=i}if(this.options.timeField.start&&this.options.timeField.end){var s=+t.properties[this.options.timeField.start],n=+t.properties[this.options.timeField.end];return s>=e&&s<=i||n>=e&&n<=i||s<=e&&n>=i}},_visibleZoom:function(){if(!this._map)return!1;var t=this._map.getZoom();return!(t>this.options.maxZoom||t<this.options.minZoom)},_handleZoomChange:function(){if(this._visibleZoom())for(var t in this._cells){var e=this._cells[t].coords,i=this._cacheKey(e);this._cache[i]&&this.addLayers(this._cache[i])}else this.removeLayers(this._currentSnapshot),this._currentSnapshot=[]},authenticate:function(t){return this.service.authenticate(t),this},metadata:function(t,e){return this.service.metadata(t,e),this},query:function(){return this.service.query()},_getMetadata:function(t){this._metadata?t(void 0,this._metadata):this.metadata(s.Util.bind((function(e,i){this._metadata=i,t(e,this._metadata)}),this))},addFeature:function(t,e,i){this.addFeatures(t,e,i)},addFeatures:function(t,e,i){this._getMetadata(s.Util.bind((function(r,n){if(r)e&&e.call(this,r,null);else{var o=t.features?t.features:[t];this.service.addFeatures(t,s.Util.bind((function(t,r){if(!t){for(var s=o.length-1;s>=0;s--)o[s].properties[n.objectIdField]=o.length>1?r[s].objectId:r.objectId,o[s].id=o.length>1?r[s].objectId:r.objectId;this._addFeatures(o)}e&&e.call(i,t,r)}),this))}}),this))},updateFeature:function(t,e,i){this.updateFeatures(t,e,i)},updateFeatures:function(t,e,i){var r=t.features?t.features:[t];this.service.updateFeatures(t,(function(t,s){if(!t){for(var n=r.length-1;n>=0;n--)this.removeLayers([r[n].id],!0);this._addFeatures(r)}e&&e.call(i,t,s)}),this)},deleteFeature:function(t,e,i){this.deleteFeatures(t,e,i)},deleteFeatures:function(t,e,i){return this.service.deleteFeatures(t,(function(t,r){var s=r.length?r:[r];if(!t&&s.length>0)for(var n=s.length-1;n>=0;n--)this.removeLayers([s[n].objectId],!0);e&&e.call(i,t,r)}),this)}}),Gt=jt.extend({options:{cacheLayers:!0},initialize:function(t){t.apikey&&(t.token=t.apikey),jt.prototype.initialize.call(this,t),this._originalStyle=this.options.style,this._layers={}},onRemove:function(t){for(var e in this._layers)t.removeLayer(this._layers[e]),this.fire("removefeature",{feature:this._layers[e].feature,permanent:!1},!0);return jt.prototype.onRemove.call(this,t)},createNewLayer:function(t){var e=s.GeoJSON.geometryToLayer(t,this.options);return e&&(e.defaultOptions=e.options),e},_updateLayer:function(t,e){var i=[],r=this.options.coordsToLatLng||s.GeoJSON.coordsToLatLng;switch(e.properties&&(t.feature.properties=e.properties),e.geometry.type){case"Point":i=s.GeoJSON.coordsToLatLng(e.geometry.coordinates),t.setLatLng(i);break;case"LineString":i=s.GeoJSON.coordsToLatLngs(e.geometry.coordinates,0,r),t.setLatLngs(i);break;case"MultiLineString":case"Polygon":i=s.GeoJSON.coordsToLatLngs(e.geometry.coordinates,1,r),t.setLatLngs(i);break;case"MultiPolygon":i=s.GeoJSON.coordsToLatLngs(e.geometry.coordinates,2,r),t.setLatLngs(i)}},createLayers:function(t){for(var e=t.length-1;e>=0;e--){var i,r=t[e],s=this._layers[r.id];!this._visibleZoom()||!s||this._map.hasLayer(s)||this.options.timeField&&!this._featureWithinTimeRange(r)||(this._map.addLayer(s),this.fire("addfeature",{feature:s.feature},!0)),s&&this.options.simplifyFactor>0&&(s.setLatLngs||s.setLatLng)&&this._updateLayer(s,r),s||((i=this.createNewLayer(r))?(i.feature=r,i.addEventParent(this),this.options.onEachFeature&&this.options.onEachFeature(i.feature,i),this._layers[i.feature.id]=i,this.setFeatureStyle(i.feature.id,this.options.style),this.fire("createfeature",{feature:i.feature},!0),this._visibleZoom()&&(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(r))&&this._map.addLayer(i)):v("invalid GeoJSON encountered"))}},addLayers:function(t){for(var e=t.length-1;e>=0;e--){var i=this._layers[t[e]];!i||this.options.timeField&&!this._featureWithinTimeRange(i.feature)||(this._map.addLayer(i),this.fire("addfeature",{feature:i.feature},!0))}},removeLayers:function(t,e){for(var i=t.length-1;i>=0;i--){var r=t[i],s=this._layers[r];s&&(this.fire("removefeature",{feature:s.feature,permanent:e},!0),this._map.removeLayer(s)),s&&e&&delete this._layers[r]}},cellEnter:function(t,e){this._visibleZoom()&&!this._zooming&&this._map&&s.Util.requestAnimFrame(s.Util.bind((function(){var t=this._cacheKey(e),i=this._cellCoordsToKey(e),r=this._cache[t];this._activeCells[i]&&r&&this.addLayers(r)}),this))},cellLeave:function(t,e){this._zooming||s.Util.requestAnimFrame(s.Util.bind((function(){if(this._map){var t=this._cacheKey(e),i=this._cellCoordsToKey(e),r=this._cache[t],s=this._map.getBounds();if(!this._activeCells[i]&&r){for(var n=!0,o=0;o<r.length;o++){var a=this._layers[r[o]];a&&a.getBounds&&s.intersects(a.getBounds())&&(n=!1)}n&&this.removeLayers(r,!this.options.cacheLayers),!this.options.cacheLayers&&n&&(delete this._cache[t],delete this._cells[i],delete this._activeCells[i])}}}),this))},resetStyle:function(){return this.options.style=this._originalStyle,this.eachFeature((function(t){this.resetFeatureStyle(t.feature.id)}),this),this},setStyle:function(t){return this.options.style=t,this.eachFeature((function(e){this.setFeatureStyle(e.feature.id,t)}),this),this},resetFeatureStyle:function(t){var e=this._layers[t],i=this._originalStyle||s.Path.prototype.options;return e&&(s.Util.extend(e.options,e.defaultOptions),this.setFeatureStyle(t,i)),this},setFeatureStyle:function(t,e){var i=this._layers[t];return"function"==typeof e&&(e=e(i.feature)),i.setStyle&&i.setStyle(e),this},eachActiveFeature:function(t,e){if(this._map){var i=this._map.getBounds();for(var r in this._layers)-1!==this._currentSnapshot.indexOf(this._layers[r].feature.id)&&("function"==typeof this._layers[r].getLatLng&&i.contains(this._layers[r].getLatLng())||"function"==typeof this._layers[r].getBounds&&i.intersects(this._layers[r].getBounds()))&&t.call(e,this._layers[r])}return this},eachFeature:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getFeature:function(t){return this._layers[t]},bringToBack:function(){this.eachFeature((function(t){t.bringToBack&&t.bringToBack()}))},bringToFront:function(){this.eachFeature((function(t){t.bringToFront&&t.bringToFront()}))},redraw:function(t){return t&&this._redraw(t),this},_redraw:function(t){var e=this._layers[t],i=e.feature;if(e&&e.setIcon&&this.options.pointToLayer&&this.options.pointToLayer){var r=this.options.pointToLayer(i,Object(s.latLng)(i.geometry.coordinates[1],i.geometry.coordinates[0])).options.icon;e.setIcon(r)}if(e&&e.setStyle&&this.options.pointToLayer){var n=this.options.pointToLayer(i,Object(s.latLng)(i.geometry.coordinates[1],i.geometry.coordinates[0])).options;this.setFeatureStyle(i.id,n)}e&&e.setStyle&&this.options.style&&this.resetStyle(i.id)}});function Et(t){return new Gt(t)}var Dt=o.version,zt=i(1),Bt=i(4),qt=i.n(Bt),Zt=i(5),Nt=i.n(Zt),Wt=i(3),Jt=i.n(Wt),Vt=i(6),Qt=i.n(Vt),Ht=i(7),Kt=i.n(Ht),Xt=i(2),Yt=i.n(Xt);function $t(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=Yt()(t);if(e){var s=Yt()(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return Kt()(this,i)}}var te=function(t){Qt()(i,t);var e=$t(i);function i(){return qt()(this,i),e.apply(this,arguments)}return Nt()(i,[{key:"initialize",value:function(t){t.pane=zt.Util.defaultValue(t.pane,"tilePane"),Jt()(Yt()(i.prototype),"initialize",this).call(this,t),n.a.Util.stamp(this),this.options.id=zt.Util.defaultValue(this.options.id,this.uuid),this.options.pid=zt.Util.defaultValue(this.options.pid,-1),this.options.name=zt.Util.defaultValue(this.options.name,"")}},{key:"uuid",get:function(){return this._leaflet_id}},{key:"isAdded",get:function(){return this._map&&this._map.hasLayer(this)}},{key:"pid",get:function(){return this.options.pid},set:function(t){this.options.pid=t}},{key:"id",get:function(){return this.options.id},set:function(t){this.options.id=t}},{key:"name",get:function(){return this.options.name},set:function(t){this.options.name=t}},{key:"opacity",get:function(){return this.options.opacity},set:function(t){this.options.opacity=t,this.setOpacity(t)}},{key:"bandIds",get:function(){return this.getBandIds()},set:function(t){this.setBandIds(t)}}]),i}(Ct);function ee(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=Yt()(t);if(e){var s=Yt()(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return Kt()(this,i)}}zt.layer.ArcGisImageLayer=te,zt.LayerUtil.register("arcgis_image",te);var ie=function(t){Qt()(i,t);var e=ee(i);function i(){return qt()(this,i),e.apply(this,arguments)}return Nt()(i,[{key:"initialize",value:function(t){Jt()(Yt()(i.prototype),"initialize",this).call(this,t),n.a.Util.stamp(this),this.options.id=zt.Util.defaultValue(this.options.id,this.uuid),this.options.pid=zt.Util.defaultValue(this.options.pid,-1),this.options.name=zt.Util.defaultValue(this.options.name,"")}},{key:"uuid",get:function(){return this._leaflet_id}},{key:"isAdded",get:function(){return this._map&&this._map.hasLayer(this)}},{key:"pid",get:function(){return this.options.pid},set:function(t){this.options.pid=t}},{key:"id",get:function(){return this.options.id},set:function(t){this.options.id=t}},{key:"name",get:function(){return this.options.name},set:function(t){this.options.name=t}}]),i}(wt);function re(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=Yt()(t);if(e){var s=Yt()(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return Kt()(this,i)}}zt.layer.ArcGisTileLayer=ie,zt.LayerUtil.register("arcgis_tile",ie);var se=function(t){Qt()(i,t);var e=re(i);function i(){return qt()(this,i),e.apply(this,arguments)}return Nt()(i,[{key:"uuid",get:function(){return this._leaflet_id}},{key:"isAdded",get:function(){return this._map&&this._map.hasLayer(this)}},{key:"pid",get:function(){return this.options.pid},set:function(t){this.options.pid=t}},{key:"id",get:function(){return this.options.id},set:function(t){this.options.id=t}},{key:"name",get:function(){return this.options.name},set:function(t){this.options.name=t}},{key:"opacity",get:function(){return this.options.opacity},set:function(t){this.options.opacity=t,this.setOpacity(t)}},{key:"initialize",value:function(t){var e,r=this;t.popup&&(e=t.popup,delete t.popup),t.pane=zt.Util.defaultValue(t.pane,"tilePane"),Jt()(Yt()(i.prototype),"initialize",this).call(this,t),n.a.Util.stamp(this),this.options.id=zt.Util.defaultValue(this.options.id,this.uuid),this.options.pid=zt.Util.defaultValue(this.options.pid,-1),this.options.name=zt.Util.defaultValue(this.options.name,""),e&&this.bindPopup((function(t,i,s){if(null!=t&&t.code>0)return zt.Util.msg(t.message),!1;var n=i.graphic;return!!n&&zt.Util.getTemplateHtml({title:r.options.name,template:e,attr:n.attr})}),{maxWidth:600})}},{key:"onAdd",value:function(t){Jt()(Yt()(i.prototype),"onAdd",this).call(this,t),this._popup||!this.highlight&&!this.listens("click")||(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this))}},{key:"_renderPopup",value:function(t,e,r,s){var n,o=this,a=null===(n=this.options)||void 0===n?void 0:n.highlight,u=zt.Util.geoJsonToGraphics(r,{type:null==a?void 0:a.type,style:a}),l={layer:this,graphic:u.length>0?u[0]:null,graphics:u,geojson:r,latlng:t};this._popup&&Jt()(Yt()(i.prototype),"_renderPopup",this).call(this,t,e,l,s),u&&a&&(this._graphicLayer||(this._graphicLayer=new zt.layer.GraphicLayer({name:"高亮对象图层",noLayerManage:!0}),this._graphicLayer._mars2d_private=!0,this._map.addLayer(this._graphicLayer)),this._graphicLayer.clear(),this._graphicLayer.addGraphic(u),this._popup&&(this._popup._source=this,this.once(zt.EventType.popupclose,(function(t){o._graphicLayer.clear()})))),this.listens("click")&&this.fire(zt.EventType.click,l)}}]),i}(Rt);zt.layer.ArcGisDynamicLayer=se,zt.LayerUtil.register("arcgis_dynamic",se);var ne=i(9),oe=i.n(ne);function ae(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function ue(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ae(Object(i),!0).forEach((function(e){oe()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ae(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function le(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=Yt()(t);if(e){var s=Yt()(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return Kt()(this,i)}}var ce=function(t){Qt()(i,t);var e=le(i);function i(){return qt()(this,i),e.apply(this,arguments)}return Nt()(i,[{key:"uuid",get:function(){return this._leaflet_id}},{key:"isAdded",get:function(){return this._map&&this._map.hasLayer(this)}},{key:"pid",get:function(){return this.options.pid},set:function(t){this.options.pid=t}},{key:"id",get:function(){return this.options.id},set:function(t){this.options.id=t}},{key:"name",get:function(){return this.options.name},set:function(t){this.options.name=t}},{key:"initialize",value:function(t){var e,r,s=this;t.popup&&(e=t.popup,delete t.popup),t.tooltip&&(r=t.tooltip,delete t.tooltip),Jt()(Yt()(i.prototype),"initialize",this).call(this,function(t){var e;if(!t.symbol)return t;var i=ue({},t);null!==(e=t.symbol)&&void 0!==e&&e.styleOptions&&(i.pointToLayer=function(e,i){var r=e.properties,s=function(t,e,i){if(!t)return{};var r=ue({},t.styleOptions);if(t.styleField&&e){var s=e[t.styleField],o=t.styleFieldOptions[s];null!=o&&(r=ue(ue({},r),o))}i&&r.iconUrlForSelect&&(r.iconUrl=r.iconUrlForSelect);if(r.hasOwnProperty("iconUrl"))t.icon=n.a.icon(r);else if(r.hasOwnProperty("iconFont")){var a=20;r.hasOwnProperty("iconSize")&&(a=r.iconSize[0]);var u=r.color||"#000000";r.className="",r.html='<i class="'+r.iconFont+'" style="color:'+u+";font-size:"+a+'px;"></i> ',t.icon=n.a.divIcon(r)}else{var l='<div class="centerat_animation" style="color:'+(r.color||"#0f89f5")+';"><p></p></div>';if(t.nameField){var c=e[t.nameField];l+=' <div class="layer_divicon_name" style="top: 2px;left: 25px;" >'+c+"</div>"}t.icon=n.a.divIcon({className:"",iconSize:[10,10],iconAnchor:[5,5],popupAnchor:[5,-5],tooltipAnchor:[5,-5],html:l})}return t}(t.symbol,r);return n.a.marker(i,s)},i.style=function(e){var i=e.properties;return function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)return{};var r=t.styleOptions?ue(ue({},i),t.styleOptions):ue({},i);if(t.styleField&&e){var s=e[t.styleField],n=t.styleFieldOptions[s];null!=n&&(r=ue(ue({},r),n))}if(e)for(var o in r)r[o]=zt.Util.template(r[o],e);if("function"==typeof t.callback){var a=t.callback(e,r);null!=a&&(r=ue(ue({},r),a))}return r}(t.symbol,i)});return i}(t)),n.a.Util.stamp(this),this.options.id=zt.Util.defaultValue(this.options.id,this.uuid),this.options.pid=zt.Util.defaultValue(this.options.pid,-1),this.options.name=zt.Util.defaultValue(this.options.name,""),e&&this.bindPopup((function(t){var i=t.feature.properties;return zt.Util.getTemplateHtml({title:s.options.name,template:e,attr:i})}),{maxWidth:600}),r&&this.bindTooltip((function(t){var e=t.feature.properties;return zt.Util.getTemplateHtml({title:s.options.name,template:r,attr:e})}),{direction:"top"})}},{key:"eachGraphic",value:function(t,e){return this.eachFeature(t,e)}},{key:"getGraphicById",value:function(t){return this.getFeature(t)}}]),i}(Gt);zt.layer.ArcGisFeatureLayer=ce,zt.LayerUtil.register("arcgis_feature",ce),n.a.esri=r,zt.esri=r}])}));