/*!
 * Mars2D平台插件,结合mapv可视化功能插件
 * 版本信息：v3.0.9
 * 编译日期：2022-03-03 19:27:34
 * 版权所有：Copyright by 火星科技  http://mars2d.cn
 */
(function webpackUniversalModuleDefinition(window) {
  let mars2d = window.mars2d //通过index.html的head引入
  if (!mars2d && typeof exports === 'object') {
    mars2d = require("mars2d")
    window['mars2d'] = mars2d
  }
  if (!mars2d) {
    console.error('请引入mars2d库，可参考教程：http://mars2d.cn/dev/guide/start/download.html')
  }


  let mapv = window.mapv //通过index.html的head引入
  if (!mapv && typeof exports === 'mapv') {
    mapv = require("mapv")
    window['mapv'] = mapv
  }

/*!
 * Mars2D平台插件,结合mapv可视化功能插件
 * 版本信息：v3.0.9, hash值: f3e3a55bcb7be48db43c
 * 编译日期：2022-03-03 19:27:34
 * 版权所有：Copyright by 火星科技 http://mars2d.cn
 * 
 */
window.mars2dMapv=function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=10)}([function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=window.mars2d},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=window.mapv},function(t,e,n){var o=n(12).default,i=n(2);t.exports=function(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return i(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}t.exports=function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){var o=n(11);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(t,"prototype",{value:Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),writable:!1}),e&&o(t,e)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){var o=n(13);function i(){return"undefined"!=typeof Reflect&&Reflect.get?(t.exports=i=Reflect.get,t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=i=function(t,e,n){var i=o(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}},t.exports.__esModule=!0,t.exports.default=t.exports),i.apply(this,arguments)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){"use strict";n.d(e,"a",(function(){return S}));var o=n(5),i=n.n(o),r=n(6),a=n.n(r),s=n(7),u=n.n(s),c=n(4),l=n.n(c),p=n(0),f=n.n(p),d=n(1),h=n(2),v=n.n(h),y=n(8),m=n.n(y),x=n(3);function _(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=f()(t);if(e){var i=f()(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return l()(this,n)}}var g=d.L,b=x?x.baiduMapLayer:null,k=b?b.__proto__:Function,E=function(t){u()(n,t);var e=_(n);function n(t,o,r,a){var s;if(i()(this,n),s=e.call(this,t,r,a),!k)return l()(s);var u=v()(s);return a=a||{},u.init(a),u.argCheck(a),s.canvasLayer=o,s.clickEvent=s.clickEvent.bind(v()(s)),s.mousemoveEvent=s.mousemoveEvent.bind(v()(s)),s._moveStartEvent=s.moveStartEvent.bind(v()(s)),s._moveEndEvent=s.moveEndEvent.bind(v()(s)),s._zoomStartEvent=s.zoomStartEvent.bind(v()(s)),s.bindEvent(),s}return a()(n,[{key:"clickEvent",value:function(t){var e=this.map.containerPointToLayerPoint([0,0]),o=this.devicePixelRatio=this.canvasLayer.devicePixelRatio=window.devicePixelRatio,i=t.layerPoint;m()(f()(n.prototype),"clickEvent",this).call(this,g.point((i.x-e.x)/o,(i.y-e.y)/o),t)}},{key:"mousemoveEvent",value:function(t){var e=t.layerPoint;m()(f()(n.prototype),"mousemoveEvent",this).call(this,e,t)}},{key:"bindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.on("click",this.clickEvent),this.options.methods.mousemove&&t.on("mousemove",this.mousemoveEvent)),this.map.on("movestart",this._moveStartEvent),this.map.on("moveend",this._moveEndEvent),this.map.on("zoomstart",this._zoomStartEvent)}},{key:"destroy",value:function(){this.unbindEvent(),this.clearData(),this.animator&&this.animator.stop(),this.animator=null,this.canvasLayer=null}},{key:"unbindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent),this.options.methods.mousemove&&t.off("mousemove",this.mousemoveEvent)),this.map.off("movestart",this._moveStartEvent),this.map.off("moveend",this._moveEndEvent),this.map.off("zoomstart",this._zoomStartEvent)}},{key:"getContext",value:function(){return this.canvasLayer.getCanvas().getContext(this.context)}},{key:"addData",value:function(t,e){var n=t;t&&t.get&&(n=t.get()),this.dataSet.add(n),this.update({options:e})}},{key:"update",value:function(t){var e=t||{},o=e.data;o&&o.get&&(o=o.get()),null!=o&&this.dataSet.set(o),m()(f()(n.prototype),"update",this).call(this,{options:e.options})}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(t){if(this.dataSet){var e=this.dataSet.get({filter:function(e){return null==t||"function"!=typeof t||!t(e)}});this.dataSet.set(e),this.update({options:null})}}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"_canvasUpdate",value:function(t){if(this.canvasLayer){var e=this;try{var n=e.options.animation,o=this.getContext(),i=this.map;if(e.isEnabledTime()){if(void 0===t)return void this.clear(o);"2d"===this.context&&(o.save(),o.globalCompositeOperation="destination-out",o.fillStyle="rgba(0, 0, 0, .1)",o.fillRect(0,0,o.canvas.width,o.canvas.height),o.restore())}else this.clear(o);if("2d"===this.context)for(var r in e.options)o[r]=e.options[r];else o.clear(o.COLOR_BUFFER_BIT);if(e.options.minZoom&&i.getZoom()<e.options.minZoom||e.options.maxZoom&&i.getZoom()>e.options.maxZoom)return;var a=i.getBounds(),s=a.getEast()-a.getWest(),u=a.getNorth()-a.getSouth(),c=i.getSize(),l=s/c.x,p=u/c.y,f=this.canvasLayer.getTopLeft(),d=i.latLngToAccurateContainerPoint(f),h={transferCoordinate:function(t){var n,o={x:(n="2d"===e.context?i.latLngToAccurateContainerPoint(g.latLng(t[1],t[0])):{x:(t[0]-f.lng)/l,y:(f.lat-t[1])/p}).x-d.x,y:n.y-d.x};return[o.x,o.y]}};void 0!==t&&(h.filter=function(e){var o=n.trails||10;return t&&e.time>t-o&&e.time<t});var v=e.dataSet.get(h);this.processData(v),e.options._size=e.options.size;var y=i.latLngToContainerPoint(g.latLng(0,0)),m={x:y.x-d.x,y:y.y-d.y};this.drawContext(o,v,e.options,m),e.options.updateCallback&&e.options.updateCallback(t)}catch(t){console.log("mapv渲染异常",t)}}}},{key:"init",value:function(t){this.options=t,this.initDataRange(t),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(this.options.zIndex),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){}},{key:"moveStartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start,this._hide())}},{key:"moveEndEvent",value:function(){this.canvasLayer.draw(),this._show()}},{key:"zoomStartEvent",value:function(){this._hide()}},{key:"clear",value:function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}},{key:"_hide",value:function(){this.canvasLayer.canvas.style.display="none"}},{key:"_show",value:function(){this.canvasLayer.canvas.style.display="block"}},{key:"draw",value:function(){this.canvasLayer.draw()}}]),n}(k);function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=f()(t);if(e){var i=f()(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return l()(this,n)}}var R=d.L,S=function(t){u()(n,t);var e=w(n);function n(){return i()(this,n),e.apply(this,arguments)}return a()(n,[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;this.options=t,this.dataSet=e||new this.mapv.DataSet(t.data),R.Util.stamp(this),this.options.id=d.Util.defaultValue(this.options.id,this.uuid),this.options.pid=d.Util.defaultValue(this.options.pid,-1),this.options.name=d.Util.defaultValue(this.options.name,"")}},{key:"uuid",get:function(){return this._leaflet_id}},{key:"isAdded",get:function(){return this._map&&this._map.hasLayer(this)}},{key:"pid",get:function(){return this.options.pid},set:function(t){this.options.pid=t}},{key:"id",get:function(){return this.options.id},set:function(t){this.options.id=t}},{key:"name",get:function(){return this.options.name},set:function(t){this.options.name=t}},{key:"onAdd",value:function(t){this._map=t;var e=t.getPane(this.options.pane||"overlayPane"),n=R.DomUtil.create("div","leaflet-layer leaflet-zoom-animated",e);n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.zIndex=this.options.zIndex||99,this.canvas=this._createCanvas(),n.appendChild(this.canvas);var o=t.getSize();n.style.width=o.x+"px",n.style.height=o.y+"px",this.container=n,this._mapVRenderer=new E(t,this,this.dataSet,this.options),this.draw(),this.fire("loaded")}},{key:"onRemove",value:function(t){R.DomUtil.remove(this.container),this._mapVRenderer.destroy(),delete this.container,delete this.canvas,t.off({moveend:this.draw,zoomstart:this._hide,zoomend:this._show},this)}},{key:"addData",value:function(t){this._mapVRenderer&&this._mapVRenderer.addData(t,this.options)}},{key:"updateData",value:function(t){this._mapVRenderer&&this._mapVRenderer.updateData(t,this.options)}},{key:"getData",value:function(){return this._mapVRenderer&&(this.dataSet=this._mapVRenderer.getData()),this.dataSet}},{key:"removeData",value:function(t){this._mapVRenderer&&this._mapVRenderer.removeData(t)}},{key:"removeAllData",value:function(){this._mapVRenderer&&this._mapVRenderer.clearData()}},{key:"draw",value:function(){this._reset()}},{key:"setZIndex",value:function(t){this.options.zIndex=t,this.container&&(this.container.style.zIndex=t)}},{key:"render",value:function(){this._mapVRenderer._canvasUpdate()}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getContainer",value:function(){return this.container}},{key:"getTopLeft",value:function(){var t,e=this._map;e&&(t=e.getBounds().getNorthWest());return t}},{key:"_createCanvas",value:function(){var t=document.createElement("canvas");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=this.options.zIndex||600;var e="undefined"==typeof window?{}:window,n=this.devicePixelRatio=e.devicePixelRatio;return"2d"==this.options.context&&t.getContext("2d").scale(n,n),t}},{key:"_resize",value:function(){var t=this.canvas;if(t){var e=this._map,n=e.getSize();t.width=n.x,t.height=n.y,t.style.width=n.x+"px",t.style.height=n.y+"px";var o=e.getBounds(),i=e.latLngToLayerPoint(o.getNorthWest());R.DomUtil.setPosition(t,i)}}},{key:"_reset",value:function(){this._resize(),this._render()}},{key:"redraw",value:function(){this._resize(),this._render()}},{key:"_render",value:function(){this.render()}}]),n}(R.Layer);d.layer.MapVLayer=S,d.LayerUtil.register("mapv",S)},function(t,e,n){"use strict";n.r(e);var o=n(9);n.d(e,"MapVLayer",(function(){return o.a}));var i=n(3);for(var r in i)["default","MapVLayer"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(r)},function(t,e){function n(e,o){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},t.exports.__esModule=!0,t.exports.default=t.exports,n(e,o)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function n(e){return t.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){var o=n(0);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t},t.exports.__esModule=!0,t.exports.default=t.exports}]);

})(window);

